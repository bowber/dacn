% ============================================================
% Chương 4: Phương pháp tối ưu năng suất
% ============================================================

\newpage
\section{GIẢI PHÁP TỐI ƯU HÓA NĂNG SUẤT}

% ------------------------------------------------------------
\subsection{Phân tích vận hành hệ thống}
% ------------------------------------------------------------

\subsubsection{Năng lượng cung cấp cho reboiler}

Reboiler sử dụng điện trở gia nhiệt với công suất tối đa 6000W (2 điện trở × 3000W). Năng lượng tiêu thụ tại reboiler được tính theo công thức:

\begin{equation}
    E_R = P_R \times t
\end{equation}

Trong đó:
\begin{itemize}
    \item $E_R$: Năng lượng tiêu thụ (kWh)
    \item $P_R$: Công suất reboiler (kW)
    \item $t$: Thời gian vận hành (h)
\end{itemize}

Công suất reboiler được điều khiển thông qua bộ điều khiển nhiệt độ đỉnh tháp. Khi hệ thống hoạt động ổn định, công suất reboiler phụ thuộc vào:
\begin{itemize}
    \item Lưu lượng nhập liệu
    \item Nhiệt độ nhập liệu
    \item Công suất làm mát tại bộ ngưng tụ
    \item Nhiệt mất mát ra môi trường
\end{itemize}

\subsubsection{Công suất làm mát tại bộ ngưng tụ}

Bộ ngưng tụ sử dụng nước làm mát để ngưng tụ hơi ethanol từ đỉnh tháp. Công suất làm mát được tính:

\begin{equation}
    Q_C = \dot{m}_{cw} \times C_p \times \Delta T_{cw}
\end{equation}

Trong đó:
\begin{itemize}
    \item $Q_C$: Công suất làm mát (kW)
    \item $\dot{m}_{cw}$: Lưu lượng nước làm mát (kg/s)
    \item $C_p$: Nhiệt dung riêng của nước (4.18 kJ/kg.K)
    \item $\Delta T_{cw}$: Độ tăng nhiệt độ nước làm mát (K)
\end{itemize}

Lưu lượng nước làm mát phụ thuộc vào độ mở van:
\begin{equation}
    \dot{m}_{cw} = \dot{m}_{cw,max} \times \frac{u}{100}
\end{equation}

Trong đó $u$ là độ mở van (0--100\%).

\subsubsection{Cân bằng năng lượng và năng suất sản phẩm}

Ở trạng thái xác lập, cân bằng năng lượng cho hệ thống:

\begin{equation}
    Q_R = Q_C + Q_{product} + Q_{loss}
\end{equation}

Trong đó:
\begin{itemize}
    \item $Q_R$: Công suất reboiler
    \item $Q_C$: Công suất làm mát
    \item $Q_{product}$: Nhiệt lượng mang theo sản phẩm
    \item $Q_{loss}$: Nhiệt mất mát ra môi trường
\end{itemize}

Khi giữ nguyên $Q_R$ và giảm $Q_C$ (bằng cách giảm độ mở van làm mát), lượng nhiệt dành cho sản phẩm ($Q_{product}$) sẽ tăng, dẫn đến tăng năng suất sản phẩm đỉnh.

% ------------------------------------------------------------
\subsection{Phân tích vấn đề khi vận hành hiện tại}
% ------------------------------------------------------------

\subsubsection{Vận hành với van làm mát mở 100\%}

Trong phương án vận hành hiện tại, van nước làm mát được mở cố định ở mức 100\%. Điều kiện vận hành:
\begin{itemize}
    \item Lưu lượng nhập liệu: $\sim$4.8 L/h (80 ml/min)
    \item Nồng độ nhập liệu: 15\% vol ethanol
    \item Công suất reboiler tối đa: 6000W
    \item Van làm mát: Mở 100\%
\end{itemize}

\subsubsection{Phân tích nguyên nhân hạn chế năng suất}

Khi van làm mát mở 100\%:
\begin{enumerate}
    \item Công suất ngưng tụ ($Q_C$) lớn hơn nhiều so với lượng hơi cần ngưng tụ.
    \item Hơi ethanol ngưng tụ quá mức, tạo lượng hồi lưu lớn hơn cần thiết.
    \item Tỷ số hồi lưu cao làm giảm năng suất sản phẩm đỉnh.
    \item Với cùng năng lượng cung cấp, hệ thống không đạt năng suất tối ưu.
\end{enumerate}

Mối quan hệ giữa lưu lượng sản phẩm đỉnh và lưu lượng hồi lưu:
\begin{equation}
    D = \frac{L}{R}
\end{equation}

Trong đó:
\begin{itemize}
    \item $D$: Lưu lượng sản phẩm đỉnh (L/h)
    \item $L$: Lưu lượng hồi lưu (L/h) -- đo được qua lưu lượng kế
    \item $R$: Tỷ số hồi lưu
\end{itemize}

% ------------------------------------------------------------
\subsection{Thiết kế hệ thống điều khiển tối ưu năng suất}
% ------------------------------------------------------------

\subsubsection{Cấu trúc vòng điều khiển áp suất}

Vòng điều khiển áp suất đỉnh tháp (PC-01) được thiết kế với:
\begin{itemize}
    \item \textbf{Biến được điều khiển (PV):} Áp suất đỉnh tháp
    \item \textbf{Biến điều khiển (MV):} Độ mở van nước làm mát
    \item \textbf{Giá trị đặt (SP):} Sẽ được xác định qua mô phỏng
    \item \textbf{Thuật toán điều khiển:} PID
\end{itemize}

\textbf{Lựa chọn giá trị đặt áp suất:}

Giá trị đặt áp suất được chọn dựa trên các tiêu chí:
\begin{itemize}
    \item Đủ cao để đảm bảo hơi ngưng tụ hiệu quả
    \item Không quá cao gây nguy hiểm cho thiết bị
    \item Tối ưu cho quá trình phân tách và năng suất sản phẩm
\end{itemize}

\subsubsection{Phương pháp xác định thông số bộ điều khiển PID}

Thông số PID có thể được xác định bằng nhiều phương pháp:

\textbf{Phương pháp 1: Ziegler-Nichols (thực nghiệm)}

Thực hiện thí nghiệm step response bằng cách thay đổi độ mở van và ghi nhận đáp ứng áp suất. Từ đáp ứng bước, xác định các thông số:
\begin{itemize}
    \item Độ lợi quá trình: $K_p = \frac{\Delta PV}{\Delta MV}$
    \item Hằng số thời gian: $\tau$
    \item Thời gian trễ: $\theta$
\end{itemize}

Áp dụng công thức Ziegler-Nichols cho hệ bậc nhất có trễ:

\begin{table}[H]
\centering
\begin{tabular}{|c|c|c|c|}
\hline
\textbf{Bộ điều khiển} & \textbf{$K_c$} & \textbf{$T_i$} & \textbf{$T_d$} \\
\hline
P & $\frac{\tau}{K_p \cdot \theta}$ & -- & -- \\
\hline
PI & $\frac{0.9\tau}{K_p \cdot \theta}$ & $3.3\theta$ & -- \\
\hline
PID & $\frac{1.2\tau}{K_p \cdot \theta}$ & $2\theta$ & $0.5\theta$ \\
\hline
\end{tabular}
\caption{Công thức tính thông số PID theo Ziegler-Nichols}
\label{tab:pid_tuning}
\end{table}

\textbf{Phương pháp 2: Mô phỏng (được sử dụng trong đồ án này)}

Xây dựng mô hình toán học của hệ thống và sử dụng công cụ mô phỏng (Python/Matlab) để:
\begin{enumerate}
    \item Mô phỏng đáp ứng của hệ thống với các thông số PID khác nhau
    \item Tối ưu hóa thông số PID theo tiêu chí IAE (Integral Absolute Error) hoặc ISE (Integral Square Error)
    \item Kiểm chứng tính ổn định và hiệu quả của bộ điều khiển
\end{enumerate}

% ------------------------------------------------------------
\subsection{Mô hình hóa hệ thống}
% ------------------------------------------------------------

\subsubsection{Mô hình bộ ngưng tụ}

Bộ ngưng tụ có thể được mô hình hóa như một hệ bậc nhất với thời gian trễ:

\begin{equation}
    G_{condenser}(s) = \frac{K_c}{(\tau_c s + 1)} e^{-\theta_c s}
\end{equation}

Trong đó:
\begin{itemize}
    \item $K_c$: Độ lợi tĩnh (bar/\% mở van)
    \item $\tau_c$: Hằng số thời gian (s)
    \item $\theta_c$: Thời gian trễ (s)
\end{itemize}

\subsubsection{Mô hình van điều khiển}

Van điều khiển có đặc tính tuyến tính hoặc đẳng phần trăm:

\textbf{Đặc tính tuyến tính:}
\begin{equation}
    \dot{m}_{cw} = \dot{m}_{cw,max} \times \frac{u}{100}
\end{equation}

\textbf{Đặc tính đẳng phần trăm:}
\begin{equation}
    \dot{m}_{cw} = \dot{m}_{cw,max} \times R^{(u/100 - 1)}
\end{equation}

Trong đó $R$ là tỉ số rangeability của van (thường $R = 50$).

\subsubsection{Mô hình tổng thể}

Sơ đồ khối của hệ thống điều khiển:

\begin{figure}[H]
\centering
\begin{tikzpicture}[node distance=1.8cm]
    % Setpoint
    \node (sp) {SP};
    
    % Sum
    \node[sum, right=1cm of sp] (sum) {};
    
    % Controller
    \node[block, right=1.2cm of sum] (controller) {$G_c(s)$};
    
    % Valve
    \node[block, right=1.2cm of controller] (valve) {$G_v(s)$};
    
    % Process
    \node[block, right=1.2cm of valve, minimum width=2cm] (process) {$G_p(s)$};
    
    % Output
    \node[right=1cm of process] (output) {PV};
    
    % Sensor
    \node[block, below=1cm of controller] (sensor) {$G_m(s)$};
    
    % Arrows
    \draw[arrow] (sp) -- node[above, font=\normalsize] {$+$} (sum);
    \draw[arrow] (sum) -- node[above, font=\normalsize] {$e$} (controller);
    \draw[arrow] (controller) -- node[above, font=\normalsize] {$u$} (valve);
    \draw[arrow] (valve) -- (process);
    \draw[arrow] (process) -- (output);
    
    % Feedback
    \coordinate (fb) at ($(process.east)!0.5!(output.west)$);
    \draw[line] (fb) |- (sensor);
    \draw[arrow] (sensor) -| node[pos=0.95, left, font=\normalsize] {$-$} (sum);
    
\end{tikzpicture}
\caption{Sơ đồ khối hệ thống điều khiển áp suất đỉnh tháp}
\label{fig:control_block_diagram}
\end{figure}

Trong đó:
\begin{itemize}
    \item $G_c(s)$: Hàm truyền bộ điều khiển PID
    \item $G_v(s)$: Hàm truyền van điều khiển
    \item $G_p(s)$: Hàm truyền quá trình (bộ ngưng tụ + tháp)
    \item $G_m(s)$: Hàm truyền cảm biến
\end{itemize}

Hàm truyền bộ điều khiển PID:
\begin{equation}
    G_c(s) = K_c \left( 1 + \frac{1}{T_i s} + T_d s \right)
\end{equation}

% ------------------------------------------------------------
\subsection{Tiêu chí đánh giá hiệu quả}
% ------------------------------------------------------------

Hiệu quả của hệ thống điều khiển được đánh giá dựa trên các tiêu chí:

\subsubsection{Tiêu chí chất lượng điều khiển}

\begin{itemize}
    \item \textbf{Thời gian xác lập ($t_s$):} Thời gian để đáp ứng đạt và duy trì trong khoảng $\pm$2\% của giá trị xác lập.
    \item \textbf{Độ quá điều chỉnh ($\sigma$):} Phần trăm vượt quá giá trị xác lập.
    \item \textbf{Sai lệch tĩnh ($e_{ss}$):} Sai lệch giữa giá trị đặt và giá trị xác lập.
\end{itemize}

\subsubsection{Tiêu chí năng suất}

\textbf{Hiệu suất tăng năng suất:}
\begin{equation}
    \eta_{productivity} = \frac{D_{optimal} - D_{baseline}}{D_{baseline}} \times 100\%
\end{equation}

Trong đó:
\begin{itemize}
    \item $D_{optimal}$: Lưu lượng sản phẩm đỉnh khi điều khiển tối ưu
    \item $D_{baseline}$: Lưu lượng sản phẩm đỉnh khi van mở 100\%
\end{itemize}

\textbf{Tiết kiệm nước làm mát:}
\begin{equation}
    \eta_{water} = \frac{\dot{m}_{cw,baseline} - \dot{m}_{cw,optimal}}{\dot{m}_{cw,baseline}} \times 100\%
\end{equation}

Các giá trị cụ thể sẽ được xác định thông qua mô phỏng ở chương tiếp theo.
