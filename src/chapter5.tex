% ============================================================
% Chương 5: Mô phỏng và kết quả
% ============================================================

\newpage
\section{MÔ PHỎNG VÀ KẾT QUẢ}

% ------------------------------------------------------------
\subsection{Thiết lập mô phỏng}
% ------------------------------------------------------------

\subsubsection{Công cụ mô phỏng}

Mô phỏng được thực hiện bằng ngôn ngữ Python với các thư viện:
\begin{itemize}
    \item \texttt{numpy}: Tính toán số học
    \item \texttt{scipy}: Giải phương trình vi phân, tối ưu hóa
    \item \texttt{matplotlib}: Vẽ đồ thị
    \item \texttt{control}: Phân tích hệ thống điều khiển
\end{itemize}

\subsubsection{Thông số mô phỏng}

Các thông số hệ thống được sử dụng trong mô phỏng:

\begin{table}[H]
\centering
\begin{tabular}{|l|c|c|}
\hline
\textbf{Thông số} & \textbf{Giá trị} & \textbf{Đơn vị} \\
\hline
Công suất reboiler tối đa & 6000 & W \\
\hline
Lưu lượng nước làm mát tối đa & 7.2 & L/min \\
\hline
Diện tích trao đổi nhiệt condenser & 0.28 & m$^2$ \\
\hline
Áp suất vận hành & 1.0 & bar \\
\hline
Nồng độ nhập liệu & 10 & \% vol \\
\hline
Lưu lượng nhập liệu & 4.8 & L/h \\
\hline
\end{tabular}
\caption{Thông số hệ thống cho mô phỏng}
\label{tab:simulation_params}
\end{table}

% ------------------------------------------------------------
\subsection{Kết quả mô phỏng}
% ------------------------------------------------------------

Mô phỏng được chạy trong 60 phút (3600 giây) với bước thời gian $\Delta t = 1$ giây.

\subsubsection{Mô phỏng vận hành baseline (van mở 100\%)}

Trong chế độ vận hành baseline, van nước làm mát được mở hoàn toàn (100\%) -- đây là cách vận hành truyền thống không có điều khiển tự động.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{../simulation/outputs/fig_baseline_combined.png}
\caption{Mô phỏng vận hành baseline: Áp suất và lưu lượng sản phẩm khi van làm mát mở 100\%}
\label{fig:sim_baseline}
\end{figure}

Kết quả mô phỏng baseline cho thấy:
\begin{itemize}
    \item Áp suất đỉnh tháp ổn định tại 1.0 bar (tháp hở khí quyển).
    \item Van nước làm mát mở 100\% -- gây lãng phí nước làm mát.
    \item Lưu lượng sản phẩm đỉnh ổn định ở 1.52 L/h.
    \item Nhiệt độ đỉnh ổn định tại 78.1°C.
    \item Công suất ngưng tụ: 6175 W (vượt quá nhu cầu thực tế 4500 W).
\end{itemize}

\subsubsection{Mô phỏng với điều khiển áp suất PID}

Bộ điều khiển PID được cài đặt với các thông số:
\begin{itemize}
    \item $K_c = 400$ -- Độ lợi bộ điều khiển
    \item $T_i = 30$ s -- Hằng số thời gian tích phân
    \item $T_d = 0$ s -- Hằng số thời gian vi phân (điều khiển PI)
    \item Setpoint: 1.0 bar
\end{itemize}

Mô phỏng bao gồm nhiễu loạn: tăng 10\% công suất reboiler tại $t = 600$ s (phút thứ 10).

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{../simulation/outputs/fig_pid_combined.png}
\caption{Mô phỏng điều khiển PID: Áp suất, độ mở van và lưu lượng sản phẩm}
\label{fig:sim_pressure_response}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{../simulation/outputs/fig_pid_valve.png}
\caption{Đáp ứng độ mở van làm mát theo thời gian với điều khiển PID}
\label{fig:sim_valve_position}
\end{figure}

Kết quả mô phỏng PID cho thấy:
\begin{itemize}
    \item Áp suất được duy trì ổn định tại 1.0 bar (giống baseline).
    \item Van làm mát chỉ mở trung bình 24\% (so với 100\% baseline) -- tiết kiệm 76\% nước.
    \item Khi có nhiễu (+10\% công suất reboiler tại $t = 600$ s), van tự động tăng từ 20\% lên 25\%.
    \item Độ lệch áp suất tối đa khi có nhiễu: < 1 mbar.
    \item Công suất ngưng tụ: 5665 W (phù hợp với nhu cầu).
\end{itemize}

% ------------------------------------------------------------
\subsection{So sánh hiệu quả vận hành}
% ------------------------------------------------------------

Bảng \ref{tab:sim_productivity_comparison} so sánh kết quả mô phỏng giữa hai phương án vận hành.

\begin{table}[H]
\centering
\begin{tabular}{|l|c|c|c|}
\hline
\textbf{Thông số} & \textbf{Baseline} & \textbf{PID Control} & \textbf{Đơn vị} \\
\hline
Áp suất xác lập & 1.00 & 1.00 & bar \\
\hline
Độ mở van xác lập & 100 & 25 & \% \\
\hline
Công suất ngưng tụ & 6175 & 5665 & W \\
\hline
Lưu lượng nước làm mát & 7.2 & 1.8 & L/min \\
\hline
Lưu lượng sản phẩm D & 1.52 & 1.40 & L/h \\
\hline
Nhiệt độ đỉnh tháp & 78.1 & 78.3 & °C \\
\hline
\end{tabular}
\caption{So sánh kết quả mô phỏng giữa baseline và PID control}
\label{tab:sim_productivity_comparison}
\end{table}

\begin{figure}[H]
\centering
\includegraphics[width=0.95\textwidth]{../simulation/outputs/fig_comparison_all.png}
\caption{So sánh toàn diện giữa baseline (van 100\%) và điều khiển PID}
\label{fig:sim_productivity_comparison}
\end{figure}

\textbf{Các chỉ số cải thiện chính:}
\begin{itemize}
    \item Giảm độ mở van: từ 100\% xuống 25\% (giảm 75\%)
    \item Giảm lưu lượng nước làm mát: từ 7.2 L/min xuống 1.8 L/min (tiết kiệm 75\%)
    \item Áp suất ổn định tại 1.0 bar trong cả hai trường hợp (tháp hở khí quyển)
    \item Tự động điều chỉnh khi có nhiễu loạn (+10\% công suất reboiler)
\end{itemize}

% ------------------------------------------------------------
\subsection{Thảo luận}
% ------------------------------------------------------------

\subsubsection{Phân tích kết quả mô phỏng}

Kết quả mô phỏng cho thấy:
\begin{enumerate}
    \item \textbf{Tiết kiệm nước làm mát}: Đây là lợi ích chính của hệ thống điều khiển. Van làm mát chỉ cần mở 25\% (so với 100\% baseline), tiết kiệm 75\% lượng nước làm mát.
    
    \item \textbf{Áp suất ổn định}: Do tháp chưng cất hở với khí quyển, áp suất đỉnh luôn ổn định tại 1.0 bar trong cả hai chế độ vận hành. Điều này là đặc điểm của tháp chưng cất quy mô phòng thí nghiệm.
    
    \item \textbf{Đáp ứng nhiễu tốt}: Khi có nhiễu loạn (+10\% công suất reboiler), bộ điều khiển tự động điều chỉnh van từ 20\% lên 25\% để duy trì cân bằng năng lượng.
    
    \item \textbf{Tối ưu hóa năng lượng}: PID tự động tìm độ mở van tối ưu để cân bằng giữa nhiệt cung cấp từ reboiler (4500W) và nhiệt lấy đi bởi condenser.
\end{enumerate}

\subsubsection{Giải thích cơ chế hoạt động}

Đối với tháp chưng cất quy mô phòng thí nghiệm hở với khí quyển:
\begin{itemize}
    \item Áp suất đỉnh tháp luôn xấp xỉ 1.0 bar (áp suất khí quyển) do có lỗ thông hơi.
    \item Mục tiêu điều khiển không phải là ``sửa lỗi'' áp suất, mà là \textbf{tối ưu hóa lưu lượng nước làm mát}.
    \item Khi van mở 100\%, condenser có khả năng trao đổi nhiệt ~6200W, vượt quá nhu cầu thực tế ~4500W từ reboiler.
\end{itemize}

Lợi ích của điều khiển PID:
\begin{itemize}
    \item Bộ điều khiển tự động tìm độ mở van tối ưu (~25\%) để cân bằng nhiệt.
    \item Tiết kiệm 75\% lượng nước làm mát so với vận hành thủ công (van 100\%).
    \item Giảm chi phí vận hành và tải cho hệ thống cấp nước.
    \item Tự động điều chỉnh khi điều kiện vận hành thay đổi (nhiễu loạn từ reboiler).
\end{itemize}

\subsubsection{Tính toán năng suất từ lưu lượng hồi lưu}

Lưu lượng sản phẩm đỉnh được tính gián tiếp qua lưu lượng hồi lưu (đo được qua lưu lượng kế):
\begin{equation}
    D = \frac{L}{R}
\end{equation}

Trong đó:
\begin{itemize}
    \item $D$: Lưu lượng sản phẩm đỉnh (L/h)
    \item $L$: Lưu lượng hồi lưu (L/h) -- đo trực tiếp
    \item $R$: Tỷ số hồi lưu -- xác định từ thiết kế
\end{itemize}

\subsubsection{Hạn chế của mô phỏng}

\begin{itemize}
    \item Mô hình đơn giản hóa, chưa xét đầy đủ các yếu tố phi tuyến.
    \item Chưa xem xét ảnh hưởng của nhiễu loạn (thay đổi nồng độ nhập liệu, nhiệt độ nước làm mát).
    \item Cần kiểm chứng thực nghiệm để xác nhận kết quả mô phỏng.
\end{itemize}
