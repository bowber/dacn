% ============================================================
% Preamble - Vietnamese Academic Document Settings
% Đồ án Chuyên ngành - CH4053
% ============================================================

\documentclass[12pt, a4paper]{article}

% ============================================================
% FONTS & LANGUAGE
% ============================================================
\usepackage{fontspec}
\setmainfont{TeX Gyre Termes}  % Times New Roman clone
\usepackage[vietnamese]{babel}

% ============================================================
% PAGE LAYOUT
% ============================================================
\usepackage[
    a4paper,
    left=3cm,
    right=2cm,
    top=2.5cm,
    bottom=2.5cm
]{geometry}

% Line spacing
\usepackage{setspace}
\onehalfspacing

% Paragraph indentation
\usepackage{indentfirst}
\setlength{\parindent}{1cm}

% ============================================================
% HEADERS & FOOTERS
% ============================================================
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0pt}

% ============================================================
% HEADINGS
% ============================================================
\usepackage{titlesec}

% Section (Chapter title) - 16pt bold
\titleformat{\section}
    {\normalfont\fontsize{16}{19}\bfseries}
    {\thesection.}{0.5em}{}
\titlespacing*{\section}{0pt}{24pt}{12pt}

% Subsection - 15pt bold
\titleformat{\subsection}
    {\normalfont\fontsize{15}{18}\bfseries}
    {\thesubsection.}{0.5em}{}
\titlespacing*{\subsection}{0pt}{18pt}{6pt}

% Subsubsection - 14pt bold
\titleformat{\subsubsection}
    {\normalfont\fontsize{14}{17}\bfseries}
    {\thesubsubsection.}{0.5em}{}
\titlespacing*{\subsubsection}{0pt}{12pt}{6pt}

% ============================================================
% TABLE OF CONTENTS
% ============================================================
\usepackage{tocloft}
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}

% Add dot after section numbers in ToC
\renewcommand{\cftsecaftersnum}{.}
\renewcommand{\cftsubsecaftersnum}{.}
\renewcommand{\cftsubsubsecaftersnum}{.}

% Babel (vietnamese) defines these names; override in its caption hook so
% they don't get reset at \begin{document}.
\addto\captionsvietnamese{%
    \renewcommand{\contentsname}{MỤC LỤC}%
    \renewcommand{\listfigurename}{DANH MỤC HÌNH}%
    \renewcommand{\listtablename}{DANH MỤC BẢNG}%
}

% ============================================================
% LISTS
% ============================================================
\usepackage{enumitem}
\setlist[itemize]{leftmargin=1.5cm, itemsep=2pt}
\setlist[enumerate]{leftmargin=1.5cm, itemsep=2pt}

% ============================================================
% TABLES
% ============================================================
\usepackage{booktabs}
\usepackage{array}
\usepackage{tabularx}
\usepackage{multirow}

% ============================================================
% FIGURES & GRAPHICS
% ============================================================
\usepackage{graphicx}
\usepackage{float}
\usepackage{caption}
\captionsetup{
    font=normalsize,
    labelfont=bf,
    justification=centering
}

% ============================================================
% CODE LISTINGS
% ============================================================
\usepackage{listings}
\usepackage{xcolor}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{arduino}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{blue},
    numberstyle=\small\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\small,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2,
    frame=single,
    language=C++
}

\lstset{style=arduino}

% ============================================================
% HYPERLINKS
% ============================================================
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=black,
    filecolor=black,
    urlcolor=blue,
    citecolor=black,
    breaklinks=true
}
% Allow URL breaks at more characters
\makeatletter
\g@addto@macro{\UrlBreaks}{\UrlOrds}
\makeatother

% ============================================================
% BIBLIOGRAPHY (BibLaTeX with numeric style)
% ============================================================
\usepackage[
    backend=biber,
    style=numeric,
    sorting=none
]{biblatex}
\addbibresource{references.bib}

% ============================================================
% MATH
% ============================================================
\usepackage{amsmath}
\usepackage{amssymb}

% ============================================================
% TIKZ - Block Diagrams
% ============================================================
\usepackage{tikz}
\usetikzlibrary{shapes.geometric, arrows.meta, positioning, calc, decorations.markings, decorations.pathmorphing}

% ============================================================
% PGFPLOTS - Data Visualization
% ============================================================
\usepackage{pgfplots}
\pgfplotsset{compat=1.18}
\usepgfplotslibrary{statistics}

% TikZ styles for control system block diagrams
\tikzset{
    % Block styles
    block/.style={
        rectangle, draw, thick,
        minimum height=2.5em, minimum width=3em,
        text centered, font=\normalsize
    },
    % Summing junction with × (rotated cross) inside
    sum/.style={
        circle, draw, thick,
        minimum size=1.5em,
        inner sep=0pt,
        path picture={
            \draw[thick] 
                (path picture bounding box.north west) -- (path picture bounding box.south east)
                (path picture bounding box.south west) -- (path picture bounding box.north east);
        }
    },
    % Arrow style
    arrow/.style={
        -Stealth, thick
    },
    % Line style
    line/.style={
        thick
    },
    % Label style
    labelnode/.style={
        font=\normalsize, midway
    }
}

% ============================================================
% CUSTOM COMMANDS
% ============================================================
% Bold paragraph header
\newcommand{\boldpara}[1]{\noindent\textbf{#1}\par}

% Lab section with custom numbering
\newcommand{\labsection}[1]{\section*{#1}\addcontentsline{toc}{section}{#1}}
